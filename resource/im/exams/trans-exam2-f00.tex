%%COMMENT:6:8:Medium-level cache conflict miss analysis (4x4 transpose):
\newpage
\begin{problem}{12}
This problem tests your understanding of cache conflict misses.
Consider the following matrix transpose routine

{\small\begin{verbatim}
typedef int array[2][2];

void transpose(array dst, array src) {
  int i, j;

  for (i = 0; i < 2; i++) {
    for (j = 0; j < 2; j++) {
      dst[j][i] = src[i][j];
    }
  }
}
\end{verbatim}}
running on a hypothetical machine with the following properties:
\begin{itemize}
\item {\tt sizeof(int) == 4}.
\item The {\tt src} array starts at address 0 and the {\tt dst} 
array starts at address 16 (decimal).
\item There is a single L1 cache that is direct mapped and write-allocate, 
with  a block size of 8 bytes.
\item Accesses to the {\tt src} and {\tt dst} arrays are the only
sources of read and write misses, respectively.
\end{itemize}

\begin{choice}
\item Suppose the cache has a total size of 16 data bytes (i.e.,
the block size times the number of sets is 16 bytes) and that the
cache is initially empty. Then for each {\tt row} and {\tt col},
indicate whether each access to {\tt src[row][col]} and {\tt dst[row][col]} is
a hit (h) or a miss (m).  For example, reading {\tt src[0][0]} is a
miss and writing {\tt dst[0][0]} is also a miss.

\begin{minipage}[t]{2in}
\renewcommand{\arraystretch}{1.8}
\begin{tabular}{|c||c|c|}
\hline
\multicolumn{3}{|c|}{{\tt dst} array}\\
\hline
&\mbox{\ col 0\ }&\mbox{\ col 1\ }\\
\hline
\hline
row 0&m&\\
\hline
row 1&&\\
\hline 
\end{tabular}
\end{minipage}
\begin{minipage}[t]{2in}
\renewcommand{\arraystretch}{1.8}
\begin{tabular}{|c||c|c|}
\hline
\multicolumn{3}{|c|}{{\tt src} array}\\
\hline
&\mbox{\ col 0\ }&\mbox{\ col 1\ }\\
\hline
\hline
row 0&m&\\
\hline
row 1&&\\
\hline
\end{tabular}
\end{minipage}
\comment{
Solution 

dst		src
m m		m m
m m		m h
}
\vspace{.2in}
\item Repeat part A for a cache with a total size of 32 data bytes.

\begin{minipage}[t]{2in}
\renewcommand{\arraystretch}{1.8}
\begin{tabular}{|c||c|c|}
\hline
\multicolumn{3}{|c|}{{\tt dst} array}\\
\hline
&\mbox{\ col 0\ }&\mbox{\ col 1\ }\\
\hline
\hline
row 0&m&\\
\hline
row 1&&\\
\hline
\end{tabular}
\end{minipage}
\begin{minipage}[t]{2in}
\renewcommand{\arraystretch}{1.8}
\begin{tabular}{|c||c|c|}
\hline
\multicolumn{3}{|c|}{{\tt src} array}\\
\hline
&\mbox{\ col 0\ }&\mbox{\ col 1\ }\\
\hline
\hline
row 0&m&\\
\hline
row 1&&\\
\hline
\end{tabular}
\end{minipage}
\comment{
dst		src
m h		m h
m h		m h
}
\end{choice}
\end{problem}